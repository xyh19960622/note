{"id":"sUzc","dependencies":[{"name":"/home/fippo/webrtc/adapter/package.json","includedInParent":true,"mtime":1544468815021},{"name":"../utils","loc":{"line":11,"column":23},"parent":"/home/fippo/webrtc/adapter/src/js/edge/filtericeservers.js","resolved":"/home/fippo/webrtc/adapter/src/js/utils.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.filterIceServers=t;var r=e(require(\"../utils\"));function e(r){if(r&&r.__esModule)return r;var e={};if(null!=r)for(var t in r)if(Object.prototype.hasOwnProperty.call(r,t)){var u=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(r,t):{};u.get||u.set?Object.defineProperty(e,t,u):e[t]=r[t]}return e.default=r,e}function t(e,t){var u=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&r.deprecated(\"RTCIceServer.url\",\"RTCIceServer.urls\");var n=\"string\"==typeof t;return n&&(t=[t]),t=t.filter(function(r){if(0===r.indexOf(\"stun:\"))return!1;var e=r.startsWith(\"turn\")&&!r.startsWith(\"turn:[\")&&r.includes(\"transport=udp\");return e&&!u?(u=!0,!0):e&&!u}),delete e.url,e.urls=n?t[0]:t,!!t.length}})}","map":{"mappings":[{"source":"src/js/edge/filtericeservers.js","original":{"line":9,"column":0},"generated":{"line":1,"column":0}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":13}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":20}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":35}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":43}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":56}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":57}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":64}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":68}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":76}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":93}},{"source":"src/js/edge/filtericeservers.js","original":{"line":11,"column":0},"generated":{"line":1,"column":95}},{"source":"src/js/edge/filtericeservers.js","original":{"line":11,"column":0},"generated":{"line":1,"column":99}},{"source":"src/js/edge/filtericeservers.js","original":{"line":11,"column":0},"generated":{"line":1,"column":101}},{"source":"src/js/edge/filtericeservers.js","original":{"line":11,"column":0},"generated":{"line":1,"column":103}},{"source":"src/js/edge/filtericeservers.js","original":{"line":11,"column":0},"generated":{"line":1,"column":111}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":124}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":133}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":135}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":138}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":141}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":144}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":146}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":157}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":164}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":166}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":170}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":172}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":175}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":178}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":184}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":186}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":190}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":194}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":199}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":201}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":204}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":211}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":221}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":236}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":241}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":243}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":246}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":247}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":251}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":253}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":260}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":276}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":283}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":308}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":315}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":340}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":342}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":345}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":348}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":350}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":355}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":357}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":361}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":368}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":383}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":385}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":387}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":390}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":392}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":395}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":397}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":400}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":407}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":409}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":417}},{"source":"src/js/edge/filtericeservers.js","original":{"line":51,"column":1},"generated":{"line":1,"column":419}},{"source":"src/js/edge/filtericeservers.js","original":{"line":17,"column":7},"generated":{"line":1,"column":421}},{"source":"src/js/edge/filtericeservers.js","name":"filterIceServers","original":{"line":17,"column":16},"generated":{"line":1,"column":430}},{"source":"src/js/edge/filtericeservers.js","name":"iceServers","original":{"line":17,"column":33},"generated":{"line":1,"column":432}},{"source":"src/js/edge/filtericeservers.js","name":"edgeVersion","original":{"line":17,"column":45},"generated":{"line":1,"column":434}},{"source":"src/js/edge/filtericeservers.js","name":"hasTurn","original":{"line":18,"column":6},"generated":{"line":1,"column":437}},{"source":"src/js/edge/filtericeservers.js","name":"hasTurn","original":{"line":18,"column":6},"generated":{"line":1,"column":441}},{"source":"src/js/edge/filtericeservers.js","original":{"line":18,"column":16},"generated":{"line":1,"column":444}},{"source":"src/js/edge/filtericeservers.js","name":"iceServers","original":{"line":20,"column":9},"generated":{"line":1,"column":446}},{"source":"src/js/edge/filtericeservers.js","name":"iceServers","original":{"line":19,"column":2},"generated":{"line":1,"column":453}},{"source":"src/js/edge/filtericeservers.js","name":"JSON","original":{"line":19,"column":15},"generated":{"line":1,"column":455}},{"source":"src/js/edge/filtericeservers.js","name":"parse","original":{"line":19,"column":20},"generated":{"line":1,"column":460}},{"source":"src/js/edge/filtericeservers.js","name":"JSON","original":{"line":19,"column":26},"generated":{"line":1,"column":466}},{"source":"src/js/edge/filtericeservers.js","name":"stringify","original":{"line":19,"column":31},"generated":{"line":1,"column":471}},{"source":"src/js/edge/filtericeservers.js","name":"iceServers","original":{"line":19,"column":41},"generated":{"line":1,"column":481}},{"source":"src/js/edge/filtericeservers.js","name":"filter","original":{"line":20,"column":20},"generated":{"line":1,"column":486}},{"source":"src/js/edge/filtericeservers.js","original":{"line":20,"column":27},"generated":{"line":1,"column":493}},{"source":"src/js/edge/filtericeservers.js","name":"server","original":{"line":20,"column":27},"generated":{"line":1,"column":502}},{"source":"src/js/edge/filtericeservers.js","name":"server","original":{"line":21,"column":8},"generated":{"line":1,"column":505}},{"source":"src/js/edge/filtericeservers.js","name":"server","original":{"line":21,"column":8},"generated":{"line":1,"column":508}},{"source":"src/js/edge/filtericeservers.js","name":"server","original":{"line":21,"column":19},"generated":{"line":1,"column":512}},{"source":"src/js/edge/filtericeservers.js","name":"urls","original":{"line":21,"column":26},"generated":{"line":1,"column":514}},{"source":"src/js/edge/filtericeservers.js","name":"server","original":{"line":21,"column":34},"generated":{"line":1,"column":520}},{"source":"src/js/edge/filtericeservers.js","name":"url","original":{"line":21,"column":41},"generated":{"line":1,"column":522}},{"source":"src/js/edge/filtericeservers.js","original":{"line":21,"column":47},"generated":{"line":1,"column":527}},{"source":"src/js/edge/filtericeservers.js","name":"urls","original":{"line":22,"column":10},"generated":{"line":1,"column":528}},{"source":"src/js/edge/filtericeservers.js","name":"urls","original":{"line":22,"column":10},"generated":{"line":1,"column":532}},{"source":"src/js/edge/filtericeservers.js","name":"server","original":{"line":22,"column":17},"generated":{"line":1,"column":534}},{"source":"src/js/edge/filtericeservers.js","name":"urls","original":{"line":22,"column":24},"generated":{"line":1,"column":536}},{"source":"src/js/edge/filtericeservers.js","name":"server","original":{"line":22,"column":32},"generated":{"line":1,"column":542}},{"source":"src/js/edge/filtericeservers.js","name":"url","original":{"line":22,"column":39},"generated":{"line":1,"column":544}},{"source":"src/js/edge/filtericeservers.js","name":"server","original":{"line":23,"column":10},"generated":{"line":1,"column":548}},{"source":"src/js/edge/filtericeservers.js","name":"url","original":{"line":23,"column":17},"generated":{"line":1,"column":550}},{"source":"src/js/edge/filtericeservers.js","name":"server","original":{"line":23,"column":25},"generated":{"line":1,"column":556}},{"source":"src/js/edge/filtericeservers.js","name":"urls","original":{"line":23,"column":32},"generated":{"line":1,"column":558}},{"source":"src/js/edge/filtericeservers.js","name":"utils","original":{"line":24,"column":8},"generated":{"line":1,"column":564}},{"source":"src/js/edge/filtericeservers.js","name":"deprecated","original":{"line":24,"column":14},"generated":{"line":1,"column":566}},{"source":"src/js/edge/filtericeservers.js","original":{"line":24,"column":25},"generated":{"line":1,"column":577}},{"source":"src/js/edge/filtericeservers.js","original":{"line":24,"column":45},"generated":{"line":1,"column":596}},{"source":"src/js/edge/filtericeservers.js","name":"isString","original":{"line":26,"column":12},"generated":{"line":1,"column":617}},{"source":"src/js/edge/filtericeservers.js","name":"isString","original":{"line":26,"column":12},"generated":{"line":1,"column":621}},{"source":"src/js/edge/filtericeservers.js","original":{"line":26,"column":39},"generated":{"line":1,"column":623}},{"source":"src/js/edge/filtericeservers.js","name":"urls","original":{"line":26,"column":30},"generated":{"line":1,"column":640}},{"source":"src/js/edge/filtericeservers.js","original":{"line":48,"column":13},"generated":{"line":1,"column":642}},{"source":"src/js/edge/filtericeservers.js","name":"isString","original":{"line":27,"column":10},"generated":{"line":1,"column":649}},{"source":"src/js/edge/filtericeservers.js","name":"urls","original":{"line":28,"column":8},"generated":{"line":1,"column":653}},{"source":"src/js/edge/filtericeservers.js","original":{"line":28,"column":15},"generated":{"line":1,"column":655}},{"source":"src/js/edge/filtericeservers.js","name":"urls","original":{"line":28,"column":16},"generated":{"line":1,"column":656}},{"source":"src/js/edge/filtericeservers.js","name":"urls","original":{"line":30,"column":6},"generated":{"line":1,"column":660}},{"source":"src/js/edge/filtericeservers.js","name":"urls","original":{"line":30,"column":13},"generated":{"line":1,"column":662}},{"source":"src/js/edge/filtericeservers.js","name":"filter","original":{"line":30,"column":18},"generated":{"line":1,"column":664}},{"source":"src/js/edge/filtericeservers.js","original":{"line":30,"column":25},"generated":{"line":1,"column":671}},{"source":"src/js/edge/filtericeservers.js","name":"url","original":{"line":30,"column":25},"generated":{"line":1,"column":680}},{"source":"src/js/edge/filtericeservers.js","name":"url","original":{"line":32,"column":12},"generated":{"line":1,"column":683}},{"source":"src/js/edge/filtericeservers.js","original":{"line":32,"column":37},"generated":{"line":1,"column":686}},{"source":"src/js/edge/filtericeservers.js","name":"url","original":{"line":32,"column":12},"generated":{"line":1,"column":690}},{"source":"src/js/edge/filtericeservers.js","name":"indexOf","original":{"line":32,"column":16},"generated":{"line":1,"column":692}},{"source":"src/js/edge/filtericeservers.js","original":{"line":32,"column":24},"generated":{"line":1,"column":700}},{"source":"src/js/edge/filtericeservers.js","original":{"line":33,"column":17},"generated":{"line":1,"column":709}},{"source":"src/js/edge/filtericeservers.js","original":{"line":33,"column":17},"generated":{"line":1,"column":716}},{"source":"src/js/edge/filtericeservers.js","name":"validTurn","original":{"line":36,"column":14},"generated":{"line":1,"column":718}},{"source":"src/js/edge/filtericeservers.js","name":"validTurn","original":{"line":36,"column":14},"generated":{"line":1,"column":722}},{"source":"src/js/edge/filtericeservers.js","name":"url","original":{"line":36,"column":26},"generated":{"line":1,"column":724}},{"source":"src/js/edge/filtericeservers.js","name":"startsWith","original":{"line":36,"column":30},"generated":{"line":1,"column":726}},{"source":"src/js/edge/filtericeservers.js","original":{"line":36,"column":41},"generated":{"line":1,"column":737}},{"source":"src/js/edge/filtericeservers.js","name":"url","original":{"line":37,"column":13},"generated":{"line":1,"column":747}},{"source":"src/js/edge/filtericeservers.js","name":"startsWith","original":{"line":37,"column":17},"generated":{"line":1,"column":749}},{"source":"src/js/edge/filtericeservers.js","original":{"line":37,"column":28},"generated":{"line":1,"column":760}},{"source":"src/js/edge/filtericeservers.js","name":"url","original":{"line":38,"column":12},"generated":{"line":1,"column":771}},{"source":"src/js/edge/filtericeservers.js","name":"includes","original":{"line":38,"column":16},"generated":{"line":1,"column":773}},{"source":"src/js/edge/filtericeservers.js","original":{"line":38,"column":25},"generated":{"line":1,"column":782}},{"source":"src/js/edge/filtericeservers.js","name":"validTurn","original":{"line":39,"column":12},"generated":{"line":1,"column":799}},{"source":"src/js/edge/filtericeservers.js","name":"validTurn","original":{"line":39,"column":12},"generated":{"line":1,"column":806}},{"source":"src/js/edge/filtericeservers.js","name":"hasTurn","original":{"line":39,"column":26},"generated":{"line":1,"column":810}},{"source":"src/js/edge/filtericeservers.js","name":"hasTurn","original":{"line":40,"column":10},"generated":{"line":1,"column":813}},{"source":"src/js/edge/filtericeservers.js","original":{"line":40,"column":20},"generated":{"line":1,"column":816}},{"source":"src/js/edge/filtericeservers.js","original":{"line":41,"column":17},"generated":{"line":1,"column":819}},{"source":"src/js/edge/filtericeservers.js","name":"validTurn","original":{"line":43,"column":15},"generated":{"line":1,"column":822}},{"source":"src/js/edge/filtericeservers.js","name":"hasTurn","original":{"line":43,"column":29},"generated":{"line":1,"column":826}},{"source":"src/js/edge/filtericeservers.js","name":"server","original":{"line":46,"column":13},"generated":{"line":1,"column":837}},{"source":"src/js/edge/filtericeservers.js","name":"url","original":{"line":46,"column":20},"generated":{"line":1,"column":839}},{"source":"src/js/edge/filtericeservers.js","name":"server","original":{"line":47,"column":6},"generated":{"line":1,"column":843}},{"source":"src/js/edge/filtericeservers.js","name":"urls","original":{"line":47,"column":13},"generated":{"line":1,"column":845}},{"source":"src/js/edge/filtericeservers.js","name":"isString","original":{"line":47,"column":20},"generated":{"line":1,"column":850}},{"source":"src/js/edge/filtericeservers.js","name":"urls","original":{"line":47,"column":31},"generated":{"line":1,"column":852}},{"source":"src/js/edge/filtericeservers.js","original":{"line":47,"column":36},"generated":{"line":1,"column":854}},{"source":"src/js/edge/filtericeservers.js","name":"urls","original":{"line":47,"column":41},"generated":{"line":1,"column":857}},{"source":"src/js/edge/filtericeservers.js","name":"urls","original":{"line":48,"column":15},"generated":{"line":1,"column":861}},{"source":"src/js/edge/filtericeservers.js","name":"length","original":{"line":48,"column":20},"generated":{"line":1,"column":863}}],"sources":{"src/js/edge/filtericeservers.js":"/*\n *  Copyright (c) 2018 The WebRTC project authors. All Rights Reserved.\n *\n *  Use of this source code is governed by a BSD-style license\n *  that can be found in the LICENSE file in the root of the source\n *  tree.\n */\n/* eslint-env node */\n'use strict';\n\nimport * as utils from '../utils';\n// Edge does not like\n// 1) stun: filtered after 14393 unless ?transport=udp is present\n// 2) turn: that does not have all of turn:host:port?transport=udp\n// 3) turn: with ipv6 addresses\n// 4) turn: occurring muliple times\nexport function filterIceServers(iceServers, edgeVersion) {\n  let hasTurn = false;\n  iceServers = JSON.parse(JSON.stringify(iceServers));\n  return iceServers.filter(server => {\n    if (server && (server.urls || server.url)) {\n      var urls = server.urls || server.url;\n      if (server.url && !server.urls) {\n        utils.deprecated('RTCIceServer.url', 'RTCIceServer.urls');\n      }\n      const isString = typeof urls === 'string';\n      if (isString) {\n        urls = [urls];\n      }\n      urls = urls.filter(url => {\n        // filter STUN unconditionally.\n        if (url.indexOf('stun:') === 0) {\n          return false;\n        }\n\n        const validTurn = url.startsWith('turn') &&\n            !url.startsWith('turn:[') &&\n            url.includes('transport=udp');\n        if (validTurn && !hasTurn) {\n          hasTurn = true;\n          return true;\n        }\n        return validTurn && !hasTurn;\n      });\n\n      delete server.url;\n      server.urls = isString ? urls[0] : urls;\n      return !!urls.length;\n    }\n  });\n}\n"},"lineCount":null}},"hash":"c6696262c158b1057a0d28de8feb347d","cacheData":{"env":{}}}